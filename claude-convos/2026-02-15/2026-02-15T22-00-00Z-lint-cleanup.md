# Lint & TypeCheck Cleanup - Fix All Pre-existing Errors

**Date:** 2026-02-15
**Branch:** fix/lint-cleanup

## Goals

Fix all pre-existing Biome linting errors and TypeScript type errors across the codebase. Multiple workers flagged these as "not their work", so this PR cleans up the baseline.

## Key Decisions

1. **Non-null assertions (`!`) replaced with safe alternatives:**
   - In test files: Changed `result!.prop` to `result?.prop` and added `| undefined` to type declarations to satisfy both Biome and TypeScript
   - In production code (`analysis.ts`): Replaced `data.at(-1)!` with `data[data.length - 1]` plus explicit null guards (`if (x == null) return null`)

2. **String concatenation to template literals:** Biome's `useTemplate` rule - changed `str + 'T00:00:00'` to `` `${str}T00:00:00` ``

3. **Implicit any let:** Added explicit `DocumentMetadata` type annotation to untyped `let metadata` in seed-knowledge.ts

4. **Format issues:** Auto-fixed by `biome check --write` (trailing commas, import formatting, etc.)

5. **TypeScript type errors:**
   - `chat.test.tsx`: Added explicit `UseConversationReturn` type to mock state to fix narrow type inference
   - `types/checkin.ts`: Added separate `import type` for types used in file scope (re-exports don't bring types into scope)
   - `notifications.ts/test`: Resolved by running `pnpm install` (expo-notifications/expo-device were in package.json but not installed)

## Files Changed

- `apps/mobile/app/(tabs)/__tests__/chat.test.tsx` - typecheck fix (explicit mock type)
- `apps/mobile/app/analysis/race-countdown.tsx` - format fix
- `apps/mobile/app/auth/__tests__/login.test.tsx` - noNonNullAssertion
- `apps/mobile/app/auth/__tests__/signup.test.tsx` - noNonNullAssertion
- `apps/mobile/contexts/__tests__/AuthContext.test.tsx` - noNonNullAssertion
- `apps/mobile/hooks/__tests__/useAthleteProfile.test.ts` - noNonNullAssertion + type fix
- `apps/mobile/hooks/__tests__/useConstraints.test.ts` - noNonNullAssertion + type fix
- `apps/mobile/services/__tests__/intervals.test.ts` - format fix
- `apps/mobile/types/checkin.ts` - typecheck fix (import types for file scope)
- `packages/core/src/__tests__/analysis.test.ts` - format + useTemplate
- `packages/core/src/utils/analysis.ts` - format + useTemplate + noNonNullAssertion with null guards
- `supabase/functions/mcp-gateway/tools/generate-plan.ts` - format fix
- `supabase/seed/seed-knowledge.ts` - noImplicitAnyLet type annotation

## Learnings

- When replacing `!` non-null assertions with `?.` optional chaining in test files, you also need to update the variable declaration type to include `| undefined` to avoid TypeScript "used before being assigned" errors
- Array access like `data[0]` returns `T | undefined` in strict TypeScript even after a length check - need explicit null guards to narrow the type
- `export type { X } from 'y'` re-exports don't bring types into the current file's scope - need a separate `import type { X } from 'y'` for local use

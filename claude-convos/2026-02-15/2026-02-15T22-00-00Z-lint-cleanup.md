# Lint & TypeCheck Cleanup - Fix All Pre-existing Errors

**Date:** 2026-02-15
**Branch:** fix/lint-cleanup

## Goals

Fix all pre-existing Biome linting errors and TypeScript type errors across the codebase. Multiple workers flagged these as "not their work", so this PR cleans up the baseline.

## Key Decisions

1. **Non-null assertions (`!`) replaced with safe alternatives:**
   - In test files: Changed `result!.prop` to `result?.prop` and added `| undefined` to type declarations to satisfy both Biome and TypeScript
   - In production code (`analysis.ts`): Use `.at()` (SonarCloud S7755) with explicit null guards instead of `!` (Biome noNonNullAssertion)

2. **SonarCloud vs Biome alignment:**
   - SonarCloud rule S7755 prefers `.at(-N)` over `[length - N]`
   - Biome `noNonNullAssertion` warns against `!` assertions
   - Resolution: Use `.at()` + null guards (satisfies both without `!`)

3. **String concatenation to template literals:** Biome's `useTemplate` rule

4. **Implicit any let:** Added explicit `DocumentMetadata` type annotation

5. **Format issues:** Auto-fixed by `biome check --write`

6. **TypeScript type errors:**
   - `chat.test.tsx`: Added explicit `UseConversationReturn` type to mock state
   - `types/checkin.ts`: Added separate `import type` for types used in file scope
   - `notifications.ts/test`: Resolved by `pnpm install` (packages in package.json but not installed)

## Files Changed

- `apps/mobile/app/(tabs)/__tests__/chat.test.tsx` - typecheck fix (explicit mock type)
- `apps/mobile/app/analysis/race-countdown.tsx` - format fix
- `apps/mobile/app/auth/__tests__/login.test.tsx` - noNonNullAssertion
- `apps/mobile/app/auth/__tests__/signup.test.tsx` - noNonNullAssertion
- `apps/mobile/contexts/__tests__/AuthContext.test.tsx` - noNonNullAssertion
- `apps/mobile/hooks/__tests__/useAthleteProfile.test.ts` - noNonNullAssertion + type fix
- `apps/mobile/hooks/__tests__/useConstraints.test.ts` - noNonNullAssertion + type fix
- `apps/mobile/services/__tests__/intervals.test.ts` - format fix
- `apps/mobile/types/checkin.ts` - typecheck fix (import types for file scope)
- `packages/core/src/__tests__/analysis.test.ts` - format + useTemplate
- `packages/core/src/utils/analysis.ts` - useTemplate + `.at()` with null guards
- `supabase/functions/mcp-gateway/tools/generate-plan.ts` - format fix
- `supabase/seed/seed-knowledge.ts` - noImplicitAnyLet type annotation

## Learnings

- When replacing `!` non-null assertions with `?.` optional chaining in test files, also update variable declaration types to include `| undefined`
- SonarCloud S7755 prefers `.at(-N)` over `[length - N]` - use `.at()` + null guards to satisfy both SonarCloud and Biome
- `export type { X } from 'y'` re-exports don't bring types into the current file's scope - need a separate `import type { X } from 'y'`

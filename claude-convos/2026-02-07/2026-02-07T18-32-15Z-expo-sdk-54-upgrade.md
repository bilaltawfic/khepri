# Expo SDK 54 Upgrade

**Date:** 2026-02-07
**PR:** https://github.com/bilaltawfic/khepri/pull/11

## Goals

- Upgrade from Expo SDK 52 to SDK 54 for Expo Go app compatibility
- Fix any runtime errors that arise

## Key Decisions

### Package Versions
Upgraded to SDK 54 compatible versions:
- `expo`: ~52.0.0 → ~54.0.33
- `react`: 18.3.1 → 19.1.0
- `react-native`: 0.76.9 → 0.81.5
- `expo-router`: ~4.0.0 → ~6.0.23
- `react-native-reanimated`: ~3.16.0 → ~4.1.1
- `typescript`: ~5.3.3 → ~5.9.3

### Worklets Version Mismatch Fix
**Issue:** App crashed on launch with "Mismatch between JavaScript part and native part of Worklets (0.7.2 vs 0.5.1)"

**Root Cause:** react-native-reanimated 4.1.6 bundles worklets JS v0.7.2, but Expo Go SDK 54 has native worklets v0.5.1.

**Solution:**
1. Downgraded react-native-reanimated from 4.1.6 to 4.1.1 (Expo bundled version)
2. Explicitly installed react-native-worklets@0.5.1 to match Expo Go native version

### Jest/Globals Version Alignment
**Issue:** Copilot flagged that `@jest/globals@^30.2.0` was mismatched with `jest@^29.7.0`.

**Solution:** Downgraded `@jest/globals` to `^29.7.0` to match Jest version used by jest-expo.

### Claude Convos Check
Added `.github/workflows/claude-convos-check.yml` to enforce AI transparency:
- Comments on PRs with significant code changes
- Reminds contributors to log AI conversations

## Files Changed

- `apps/mobile/package.json` - Updated dependencies
- `apps/mobile/eas.json` - EAS build configuration
- `apps/mobile/app.json` - Added EAS project ID
- `pnpm-lock.yaml` - Lockfile updates
- `.github/workflows/claude-convos-check.yml` - AI conversation logging enforcement

## Learnings

1. **Expo Go version constraints:** When using Expo Go, native module versions are fixed. The JS versions must match exactly.

2. **react-native-reanimated 4.x requires explicit worklets:** Even though worklets is bundled internally, it must be explicitly installed as a peer dependency.

3. **Always verify startup in Expo Go after upgrades:** Unit tests pass but runtime can still fail due to native/JS version mismatches.

4. **Use Expo's bundled versions:** Check `npx expo install --check` and use the exact versions Expo recommends (e.g., ~4.1.1 not ~4.1.6).

## Sources

- [Expo SDK 54 Changelog](https://expo.dev/changelog/sdk-54)
- [GitHub Issue #39980 - Worklets Mismatch](https://github.com/expo/expo/issues/39980)
- [Expo Reanimated Docs](https://docs.expo.dev/versions/latest/sdk/reanimated/)

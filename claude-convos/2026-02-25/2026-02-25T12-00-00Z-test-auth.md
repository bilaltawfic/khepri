# Manual Testing: AUTH Category

## Goals
Manual testing of all 11 Authentication test cases (AUTH-01 through AUTH-11) on a physical device against remote Supabase.

## Test Results

| ID | Use Case | Result | Notes |
|----|----------|--------|-------|
| AUTH-01 | Sign up with valid credentials | PASS | Requires real email; confirm via Supabase dashboard |
| AUTH-02 | Sign up with mismatched passwords | PASS | |
| AUTH-03 | Sign up with short password | PASS | |
| AUTH-04 | Sign up with invalid email | PASS | |
| AUTH-05 | Sign up with empty fields | FAIL -> FIXED | Button was not disabled; commit cc9c895 |
| AUTH-06 | Login with valid credentials | FAIL -> FIXED | Multiple issues: no redirect, nav stacking, no sign out; commits 7669c30, b4495c2, d20b4c9 |
| AUTH-07 | Login with wrong password | PASS | |
| AUTH-08 | Login with non-existent account | PASS | |
| AUTH-09 | Protected route without auth | PASS | |
| AUTH-10 | Session persistence | PASS | |
| AUTH-11 | Duplicate email signup | FAIL -> FIXED | Supabase returns fake success for dupe emails; commit b74663c |

**Summary:** 11/11 passed (8 first-pass, 3 required fixes)

## Fixes Applied

### 1. AUTH-05: Disable auth submit buttons when fields are empty
- **Failure:** Submit button was enabled with empty fields
- **Root cause:** Button `disabled` prop only checked `isSubmitting`, not field completeness
- **Fix:** Added `isFormIncomplete` variable to both login.tsx and signup.tsx, wired to `disabled` prop
- **Commit:** cc9c895

### 2. AUTH-06 (part 1): Navigation stacking between login and signup
- **Failure:** Toggling between Sign Up and Sign In pushed new views onto stack
- **Root cause:** `<Link>` components used default push navigation
- **Fix:** Added `replace` prop to Link components in both auth screens
- **Commit:** 7669c30

### 3. AUTH-06 (part 2): No redirect after successful login
- **Failure:** Login just loaded and stayed on login page after success
- **Root cause:** login.tsx had no navigation after successful `signIn()` (unlike signup which had `router.replace('/onboarding')`)
- **Fix:** Added `router.replace('/(tabs)')` on successful login
- **Commit:** b4495c2

### 4. AUTH-06 (part 3): No sign out button
- **Failure:** User was stuck logged in with no way to sign out
- **Root cause:** Profile screen had no sign out functionality
- **Fix:** Added sign out button with Alert confirmation dialog to profile screen
- **Commit:** d20b4c9

### 5. AUTH-11: Duplicate email signup shows no error
- **Failure:** Signing up with existing email went to onboarding with no error
- **Root cause:** Supabase returns fake success (no error) for duplicate emails when email confirmation is enabled (anti-enumeration). The `data.user.identities` array is empty in this case.
- **Fix:** Check `data.user?.identities?.length === 0` after signUp and return appropriate error
- **Commit:** b74663c

## Files Changed

- `apps/mobile/app/auth/signup.tsx` - isFormIncomplete, disabled button, replace nav
- `apps/mobile/app/auth/login.tsx` - isFormIncomplete, disabled button, replace nav, router.replace on success
- `apps/mobile/app/auth/__tests__/signup.test.tsx` - tests for disabled state
- `apps/mobile/app/auth/__tests__/login.test.tsx` - tests for disabled state, redirect, mockReplace
- `apps/mobile/app/(tabs)/profile.tsx` - sign out button with confirmation dialog
- `apps/mobile/app/(tabs)/__tests__/profile.test.tsx` - useAuth/useRouter mocks, sign out test
- `apps/mobile/contexts/AuthContext.tsx` - duplicate email detection via empty identities
- `apps/mobile/contexts/__tests__/AuthContext.test.tsx` - test for duplicate email detection
- `docs/testing/manual-test-cases.csv` - updated test steps, results, and notes
- `.claude/skills/test-engineer/SKILL.md` - added CSV update step after each test

## Learnings

1. **Supabase email enumeration protection:** When email confirmation is enabled, `signUp` with an existing email returns `{ error: null }` but `data.user.identities` is an empty array. Must check for this explicitly.
2. **expo-router Link navigation:** Default `<Link>` pushes onto the navigation stack. Use `replace` prop for auth screen toggling to avoid stack buildup.
3. **Login/signup symmetry:** signup.tsx had navigation after success but login.tsx didn't - easy to miss this inconsistency.
4. **Test CSV should be updated incrementally:** Recording results after each test (not in a batch at the end) keeps the CSV accurate and makes it easier if the session is interrupted.
5. **Remote Supabase rejects fake emails:** Unlike local Supabase, the remote instance validates email domains, so test.com addresses don't work.
